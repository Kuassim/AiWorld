name: Debug Fingerprint

on:
  push:
    branches: [main]

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
    - name: Debug fingerprint format
      run: |
        echo "Current fingerprint from secret: '${{ secrets.OCI_CLI_FINGERPRINT }}'"
        echo "Fingerprint length: $(echo '${{ secrets.OCI_iCLI_FINGERPRINT }}' | wc -c)"
        
        # Create private key and generate correct fingerprint
        mkdir -p /tmp/oci-test
        echo "${{ secrets.OCI_CLI_KEY_CONTENT }}" > /tmp/oci-test/key.pem
        chmod 600 /tmp/oci-test/key.pem
        
        # Generate fingerprint from your actual private key
        CORRECT_FINGERPRINT=$(openssl rsa -pubout -outform DER -in /tmp/oci-test/key.pem 2>/dev/null | openssl md5 -c | awk -F'= ' '{print $2}')
        echo "Correct fingerprint should be: $CORRECT_FINGERPRINT"
        
        # Test if key is valid
        if openssl rsa -check -noout -in /tmp/oci-test/key.pem 2>/dev/null; then
          echo "✅ Private key is valid"
        else
          echo "❌ Private key is invalid"
        fi
        
        # Clean up
        rm -rf /tmp/oci-test
