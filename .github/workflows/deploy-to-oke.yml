name: Generate Fresh OCI Key

on:
  push:
    branches: [main]

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
    - name: Generate fresh API key pair
      run: |
        # Generate new key pair
        mkdir -p ~/fresh-keys
        openssl genrsa -out ~/fresh-keys/oci_api_key.pem 2048
        openssl rsa -pubout -in ~/fresh-keys/oci_api_key.pem -out ~/fresh-keys/oci_api_key_public.pem
        
        # Get fingerprint
        FINGERPRINT=$(openssl rsa -pubout -outform DER -in ~/fresh-keys/oci_api_key.pem | openssl md5 -c | awk -F'= ' '{print $2}')
        
        echo "=== NEW API KEY PAIR GENERATED ==="
        echo ""
        echo "1. PRIVATE KEY (for GitHub secret OCI_KEY_FILE):"
        echo "================================================"
        cat ~/fresh-keys/oci_api_key.pem
        echo "================================================"
        echo ""
        echo "2. PUBLIC KEY (upload to OCI Console):"
        echo "======================================"
        cat ~/fresh-keys/oci_api_key_public.pem
        echo "======================================"
        echo ""
        echo "3. FINGERPRINT (for GitHub secret OCI_FINGERPRINT):"
        echo "=================================================="
        echo "$FINGERPRINT"
        echo "=================================================="
        echo ""
        echo "NEXT STEPS:"
        echo "1. Copy the PRIVATE KEY above to GitHub secret: OCI_KEY_FILE"
        echo "2. Copy the FINGERPRINT above to GitHub secret: OCI_FINGERPRINT"  
        echo "3. Go to OCI Console → Profile → User Settings → API Keys"
        echo "4. Add API Key → Paste the PUBLIC KEY above"
        echo "5. Verify the fingerprint in OCI matches: $FINGERPRINT"
