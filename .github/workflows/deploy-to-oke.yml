name: Debug OCI Secrets

on:
  push:
    branches: [main]

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Debug secret formats
      run: |
        echo "=== Checking secret formats ==="
        echo "User OCID length: $(echo '${{ secrets.OCI_USER_OCID }}' | wc -c)"
        echo "User OCID starts with: $(echo '${{ secrets.OCI_USER_OCID }}' | head -c 20)"
        echo "Tenancy OCID length: $(echo '${{ secrets.OCI_TENANCY_OCID }}' | wc -c)"
        echo "Tenancy OCID starts with: $(echo '${{ secrets.OCI_TENANCY_OCID }}' | head -c 20)"
        echo "Fingerprint length: $(echo '${{ secrets.OCI_FINGERPRINT }}' | wc -c)"
        echo "Fingerprint: ${{ secrets.OCI_FINGERPRINT }}"
        echo "Region: ${{ secrets.OCI_REGION }}"
        echo "Private key starts with: $(echo '${{ secrets.OCI_KEY_FILE }}' | head -c 30)"
        
        echo "=== Testing OCID format validation ==="
        if [[ '${{ secrets.OCI_USER_OCID }}' =~ ^ocid1\.user\.oc1\. ]]; then
          echo "✅ User OCID format looks correct"
        else
          echo "❌ User OCID format is WRONG"
        fi
        
        if [[ '${{ secrets.OCI_TENANCY_OCID }}' =~ ^ocid1\.tenancy\.oc1\. ]]; then
          echo "✅ Tenancy OCID format looks correct"
        else
          echo "❌ Tenancy OCID format is WRONG"
        fi
        
        if [[ '${{ secrets.OCI_FINGERPRINT }}' =~ ^[a-f0-9]{2}(:[a-f0-9]{2}){15}$ ]]; then
          echo "✅ Fingerprint format looks correct"
        else
          echo "❌ Fingerprint format is WRONG"
        fi
